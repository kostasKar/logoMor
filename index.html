<!DOCTYPE html><html lang="en">
<head>
  <title>LogoMor</title>
  <link rel='shortcut icon' type='image/x-icon' href='/favicon.ico'>
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Inconsolata&amp;display=swap" rel="stylesheet"> 
  <!--<script src="p5.js"></script>-->
  <script src="https://cdn.jsdelivr.net/npm/p5@1.2.0/lib/p5.min.js"></script>
  <script src="seedrandom.min.js"></script>
  <link rel="stylesheet" type="text/css" href="style.css">
  <meta charset="utf-8">
  <!-- Icon library -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <script src="codemirrorLogomor/lib/codemirror.js"></script>
  <link href="codemirrorLogomor/lib/codemirror.css" rel="stylesheet">
  <script src="codemirrorLogomor/mode/logomor/logomor.js"></script>
  <link href="codemirrorLogomor/theme/logomor-theme.css" rel="stylesheet">
  <script src="codemirrorLogomor/addon/edit/matchbrackets.js"></script>
  <script src="codemirrorLogomor/addon/edit/closebrackets.js"></script>
  <script src="codemirrorLogomor/addon/selection/active-line.js"></script>
  <script src="codemirrorLogomor/addon/search/match-highlighter.js"></script>
  <script src="codemirrorLogomor/addon/search/matchesonscrollbar.js"></script>
  <script src="codemirrorLogomor/addon/scroll/annotatescrollbar.js"></script>
  <script src="codemirrorLogomor/addon/scroll/simplescrollbars.js"></script>
  <link href="codemirrorLogomor/addon/scroll/simplescrollbars.css" rel="stylesheet">
  <script src="codemirrorLogomor/addon/search/searchcursor.js"></script>
  <script src="codemirrorLogomor/addon/hint/show-hint.js"></script>
  <link rel="stylesheet" href="codemirrorLogomor/addon/hint/show-hint.css">
  <link rel="stylesheet" href="codemirrorLogomor/addon/display/fullscreen.css">
  <script src="codemirrorLogomor/addon/display/placeholder.js"></script>

  <script src="cameraManipulation.js"></script>
  <script src="drawThings.js"></script>
  <script src="logoMatrixTransformations.js"></script>
  <script src="logoCommands.js"></script>
  <script src="commandTasks.js"></script>
  <script src= "sourceCodeStringPreparation.js"></script>
  <script src="logoInterpreter.js"></script>
  <script src="argumentResolverTask.js"></script>
  <script src="parenthesisTask.js"></script>
  <script src="variableMakerTask.js"></script>
  <script src="staticVariableMaker.js"></script>
  <script src="instructionsBlockTask.js"></script>
  <script src="ifTask.js"></script>
  <script src="ifElseTask.js"></script>
  <script src="repeatTask.js"></script>
  <script src="whileTask.js"></script>
  <script src="untilTask.js"></script>
  <script src="procedurePrototype.js"></script>
  <script src="procedureTask.js"></script>
  <script src="variablesSliders.js"></script>

  <script src="taskFactory.js"></script>
  <script src="demoProgram.js"></script>
  <script src="sketch.js"></script>
  <script src="localFileSourceCode.js"></script>
  <script src="utils.js"></script>
  <script src="output.js"></script>

</head>
<body>

  <div id="p5_loading"></div>
  <div id="CameraInstructions">
    <label>Left Click: Rotate </label> 
    <label>Middle Click: Pan </label> 
    <label>Scroll Wheel: Zoom </label>
    <label>Double Click: Reset View</label>
    <span id="fpsLabel">Fps: </span><span id="fpsValue"></span>
    <div class="onoffswitch tooltip">
      <span class="tooltiptext right">Auto-Rotate</span>    
      <input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="autoRotate" tabindex="0">
      <label class="onoffswitch-label" for="autoRotate">
        <span class="onoffswitch-inner"></span>
        <span class="onoffswitch-switch"></span>
      </label>
    </div>
    <div class="onoffswitch tooltip">
      <span class="tooltiptext right">Rotation arrows</span>    
      <input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="turnsHelpArrows" tabindex="0">
      <label class="onoffswitch-label" for="turnsHelpArrows">
        <span class="onoffswitch-inner"></span>
        <span class="onoffswitch-switch"></span>
      </label>
    </div>
    <button class="tooltip" id="fullscreenButton" onclick="fullscreen(!fullscreen())">
      <i class="fa fa-expand" aria-hidden="true"></i>
      <span class="tooltiptext right">Fullscreen</span>
    </button>
  </div>

  <div id="copyright">&copy; 2021 Kostas Karouzos 
    <a href = "mailto: &#099;&#107;&#046;&#107;&#097;&#114;&#111;&#117;&#122;&#111;&#115;&#064;&#103;&#109;&#097;&#105;&#108;&#046;&#099;&#111;&#109;">&#099;&#107;&#046;&#107;&#097;&#114;&#111;&#117;&#122;&#111;&#115;&#064;&#103;&#109;&#097;&#105;&#108;&#046;&#099;&#111;&#109;</a>
    <a href="https://github.com/kostasKar/logoMor" class="fa fa-github" target="_blank"></a>
  </div> 

  <div id="drawCanvas"></div>

    <div id="controlsColumn">

      <label class="areaTitle">SOURCE CODE EDITOR</label>
      <button id="copyCodeButton" onclick="copySourceCode()">Share</button>
      <div id="sourceCodeContainer">
        <textarea id="sourceCodeTextArea" spellcheck="false" placeholder="Logo code here..."></textarea>
      </div>

      <div id="movesLimitDiv">
        <input  id="movesLimitInput" type="number" name="quantity" min="0" value="1000" onchange="redrawIfPaused()">
        <label>Moves Limit:</label>
      </div>

      <div id = "buttonDiv">
        <button id="playButton" onclick="parseLogo()">Run</button><!-- just to get rid of the space between the inline-blocks
        --><button id="stopButton" onclick="parseLogo('')">Stop</button><!--
        --><button type="button" id="saveButton" onclick="download()">Save</button><!--
        --><button onclick="openFile()">Load</button><!--
        --><button onclick=" window.open('assets/Documentation.pdf','_blank')" type="button">Help</button><!--
        --><button type="button" id="DemoButton" onclick="myCodeMirror.setValue(getRandomDemoProgram());parseLogo();">Demo</button>
        <input id="inp" type='file' style="display:none;" onchange="readFile(event)" />
      </div>

      <label class="areaTitle">CONSOLE</label>
      <textarea readonly id="consoleTextArea"></textarea>

      <div id="variablesDiv">
        <label class="areaTitle" id="variablesTitle">VARIABLES MANIPULATORS</label>
        <div class="dropdown">
          <button id="slidersAddButton" onclick="showVariablesNames()" class="dropbtn" disabled>Add</button>
          <button id="slidersClearButton" onclick="clearSliders()" class="dropbtn" disabled>Clear</button>
          <div id="variablesNamesDropdown" class="dropdown-content">
          </div>
        </div>
      </div>

  </div>


  <div id="pictureControl">
    <button class="tooltip" id="saveScreenshot" onclick="saveScreenshot()">
      <i class="fa fa-camera" aria-hidden="true"></i>
      <span class="tooltiptext left">Screenshot</span>
    </button>
    <button class="tooltip" id="record" onclick="toggleRecording()">
      <i class="fa fa-video-camera" aria-hidden="true"></i>
      <span class="tooltiptext left">Video</span>
    </button>
    <button class="tooltip" id="pause" onclick="togglePause()">
      <i class="fa fa-pause" aria-hidden="true"></i>
      <span class="tooltiptext left">Redrawing</span>
    </button>
  </div>









<!--   <button id="editorFullscreen" onclick="myCodeMirror.setOption('fullScreen', !myCodeMirror.getOption('fullScreen'))">
    <i class="fa fa-expand" aria-hidden="true"></i>
  </button> -->





  <script>
    var myCodeMirror = CodeMirror.fromTextArea
    (document.getElementById("sourceCodeTextArea"), {
      mode: "logomorMode",
      theme: "logomor-theme",
      lineNumbers: true,
      matchBrackets: true,
      autoCloseBrackets: {pairs: "()[]", explode: "[]"},
      tabSize: 2,
      styleActiveLine: true,
      highlightSelectionMatches: { showToken: false, annotateScrollbar: true },
      scrollbarStyle: "overlay",
      indentUnit: 2
    });


    CodeMirror.hint.logomor = function (editor) {
      var list = [...logomorMoves, ...logomorKeywords, ...logomorBuiltins];
      var cursor = editor.getCursor();
      var currentLine = editor.getLine(cursor.line);
      var start = cursor.ch;
      var end = start;
      while (end < currentLine.length && /[":\w$]+/.test(currentLine.charAt(end))) ++end;
      while (start && /[":\w$]+/.test(currentLine.charAt(start - 1))) --start;
      var curWord = start != end && currentLine.slice(start, end);
      var regex = new RegExp('^' + curWord, 'i');

      var resultList = (!curWord ? [] : list.filter(function (item) { return item.match(regex);})).sort();
      if ((resultList.length === 1) && (resultList[0].length === curWord.length)){
        resultList = [];
      } 

      var result = {
        list: resultList,
        from: CodeMirror.Pos(cursor.line, start),
        to: CodeMirror.Pos(cursor.line, end)
      };

          //do not hint inside comments
          if (currentLine.includes(";")){
            result = {list: [], from: CodeMirror.Pos(cursor.line, start), to: CodeMirror.Pos(cursor.line, end) };
          }

          return result;
        };

        CodeMirror.commands.autocomplete = function (cm, options) {
         CodeMirror.showHint(cm, CodeMirror.hint.logomor, options);
       };

       myCodeMirror.on("keyup", function (cm, event) {
        if (!cm.state.completionActive && /*Enables keyboard navigation in autocomplete list*/
          String.fromCharCode(event.keyCode).match(/[a-zA-Z]/)) {
          CodeMirror.commands.autocomplete(cm, {completeSingle: false});
      }
    });

  </script>


  <script type="text/javascript">
    const queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);
    if (urlParams.has('code')){
      myCodeMirror.setValue(urlParams.get('code'));
      window.history.replaceState(null, null, window.location.pathname);
    }


    function copySourceCode() {
      var sourceCodeText = myCodeMirror.getValue();
      var completeURLText = window.location.href.split('?')[0];
      if (sourceCodeText !== ""){
        completeURLText = completeURLText + "?code=" + encodeURIComponent(sourceCodeText);
      }
      var completeURL = completeURLText;
      //window.prompt("Copy to clipboard: Ctrl+C, Enter", completeURL);

      var dummy = document.createElement("textarea");
      //dummy.style.display = 'none'; //this does not allow copying
      document.body.appendChild(dummy);
      dummy.value = completeURL;
      dummy.select();
      document.execCommand("copy");
      document.body.removeChild(dummy);
      alert("Link with source code copied to clipboard");
    }



    </script>
    

</body>
</html>